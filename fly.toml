app = "autonomind"

[build]
  dockerfile = "docker/Dockerfile.cpu"

[env]
  PORT = "8080"
  NEXT_PUBLIC_FASTAPI_URL = "http://localhost:8000"
  NEXT_PUBLIC_STREAMLIT_URL = "http://localhost:8080"

[experimental]
  auto_rollback = true

# ─────────── Streamlit ────────────
[[services]]
  internal_port = 8080
  protocol      = "tcp"

  # Expose HTTP on 80/443 → internal 8080
  [[services.ports]]
    port     = 80
    handlers = ["http"]

  [[services.ports]]
    port     = 443
    handlers = ["tls", "http"]

# ─────────── FastAPI ──────────────
[[services]]
  internal_port = 8000
  protocol      = "tcp"

  # Expose it directly on 8000 to hit it from outside
  [[services.ports]]
    port     = 8000
    handlers = ["http"]

# ─────────── Next.js Frontend ─────
[[services]]
  internal_port = 3000
  protocol      = "tcp"

  # Expose Next.js at port 3000
  [[services.ports]]
    port     = 3000
    handlers = ["http"]
